# Hytale Plugin Template

This project doesn't contain a ``manifest.json``,
because it's automatically generated by the ``eu.koboo.pluginmanifest`` gradle-plugin.

The ``HytaleServer.jar`` dependency should be automatically resolved from your client's installation,
and added to your project as a dependency, done by the ``eu.koboo.pluginmanifest`` gradle-plugin.

## Overview

- [Useful links](#useful-links)
- [Tutorials](#tutorials)
- [Advanced tutorials](#tutorials)
- [ECS Cheatsheet](#entity-component-system-cheatsheet)

## Quick tips

- Enabled ``Diagnostics Mode`` in your client settings

## Useful links:

- [Hytale Discord](https://discord.gg/hytale)
- [PluginManifest GitHub](https://github.com/Koboo/hytale-pluginmanifest)
- [HytaleModding Docs](https://hytalemodding.dev/en/docs)
- [HytaleModding Discord](https://discord.gg/vg473AehHr)
- [HytaleModding Forum](https://forum.hytalemodding.dev/)
- [Curseforge Wiki](https://support.curseforge.com/en/support/solutions/folders/9000202192)
- [Hytale Server Manual](https://support.hytale.com/hc/en-us/articles/45326769420827-Hytale-Server-Manual)
- [Hytale modding tutorials by Kaupenjoe](https://www.youtube.com/@ModdingByKaupenjoe/videos)
- [Hytale modding tutorials by TroubleDEV](https://www.youtube.com/@TroubleDEV)
- [Hytale tutorials by HytaleGuides (non-official)](https://www.youtube.com/@HytaleGuidesOfficial/videos)
- [hytale.game (non-official)](https://hytale.game/en/)
- [HytaleConverter (non-official)](https://hytale-converter.com/)
- [UI WYSIWYG Editor by EllieAU](https://hytale.ellie.au/)

## Tutorials:

- [Intro to Hytale's Entity-Component-System (HytaleModding forum)](https://forum.hytalemodding.dev/d/20-intro-to-hytale-entity-component-system)
- [Hytale's Entity-Component-System Explained (YouTube)](https://youtu.be/qglU107_DA4?si=5RemzLqtBlER6HIp)
- [Thread Safety: Using world.execute()](https://forum.hytalemodding.dev/d/21-thread-safety-using-worldexecute)

## Advanced Tutorials

- [Listening to packets](https://forum.hytalemodding.dev/d/17-listening-to-packets)
- [Hytale UI Docs](https://github.com/underscore95/hytale-ui-docs/tree/main)

## Entity-Component-System Cheatsheet

### Core Classes

| Class                        | Purpose                                                 |
|------------------------------|---------------------------------------------------------|
| `Component<ECS_TYPE>`        | Interface for data containers. Must implement `clone()` |
| `ComponentType<ECS_TYPE, T>` | Type identifier for components (like a key)             |
| `Holder<ECS_TYPE>`           | Builder for assembling entities before adding to store  |
| `Ref<ECS_TYPE>`              | Reference to an entity in a store                       |
| `Store<ECS_TYPE>`            | Contains all entities and their components              |
| `Archetype<ECS_TYPE>`        | Defines a set of component types for querying           |
| `Query<ECS_TYPE>`            | Filter for finding entities with specific components    |

### Two Store Types

| Store         | Generic Type         | Use Case                                       |
|---------------|----------------------|------------------------------------------------|
| `EntityStore` | `Store<EntityStore>` | Mobile entities (players, NPCs, dropped items) |
| `ChunkStore`  | `Store<ChunkStore>`  | World chunks and block data                    |

### Summary

| Aspect      | BlockEntity (Entity)           | Block with Data (Block)     |
|-------------|--------------------------------|-----------------------------|
| Store       | `EntityStore`                  | `ChunkStore`                |
| Movement    | Can move                       | Fixed position              |
| Example     | Falling sand, dropped item     | Chest, spawn marker         |
| Java Type   | `Component<EntityStore>`       | `Component<ChunkStore>`     |
| Created via | `assembleDefaultBlockEntity()` | JSON `"BlockEntity"` config |

## Where do I get..

### PlayerRef

- ``PlayerRef playerRef = Universe.get().getPlayer(uuid);``
- ``PlayerRef playerRef = reference.getStore().getComponent(reference, PlayerRef.getComponentType());``

### Player

- ``Player player = reference.getStore().getComponent(reference, Player.getComponentType());``

### World

- ``World world = Universe.get().getWorld(uuid);``
- ``CompletableFuture<World> future = Universe.get().makeWorld(String name, Path savePath, WorldConfig worldConfig, boolean start);``

### getNeabryEntities

````java
            Vector3d playerPos = playerTransform.getPosition().clone().add(0, modelcomponent.getModel().getEyeHeight(), 0);
            List<Ref<EntityStore>> nearby = new ArrayList<>();
            SpatialResource<Ref<EntityStore>, EntityStore> itemSpatialResource = commandBuffer.getResource(EntityModule.get().getItemSpatialResourceType());
            itemSpatialResource.getSpatialStructure().collect(playerPos, ItemMagnet.INSTANCE.config.get().pickupRadius(), nearby);
            for (Ref<EntityStore> entityStoreRef : nearby) {
                TransformComponent entityPos = commandBuffer.getComponent(entityStoreRef, TransformComponent.getComponentType());
                ItemComponent pickup = commandBuffer.getComponent(entityStoreRef, ItemComponent.getComponentType());
                if (entityPos != null && pickup != null && pickup.canPickUp()) {
                    entityPos.getPosition().assign(Vector3d.lerp(entityPos.getPosition(), playerPos, ItemMagnet.INSTANCE.config.get().moveSpeed()));
                }
            }
````

